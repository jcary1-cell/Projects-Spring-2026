import React, { useState, useEffect } from 'react';
import { 
  Wind, 
  Brain, 
  ArrowUpRight,
  Sparkles,
  Eye,
  Layers,
  Activity,
  UserCheck,
  Cpu,
  RefreshCw,
  Hourglass,
  BookOpen,
  X
} from 'lucide-react';

const HAMLET_QUOTE = `Be not too tame neither, but let your own discretion be your tutor. Suit the action to the word, the word to the action, with this special observance, that you o’erstep not the modesty of nature. For anything so o’erdone is from the purpose of playing, whose end, both at the first and now, was and is to hold, as ’twere, the mirror up to nature.`;

// --- UI Components ---

const FloatingMatter = ({ delay = 0, color = "bg-indigo-500/20", size = 300 }) => (
  <div 
    className={`absolute rounded-full blur-[100px] animate-pulse pointer-events-none transition-all duration-1000 ${color}`}
    style={{
      width: size + 'px',
      height: size + 'px',
      left: (Math.random() * 80 + 10) + '%',
      top: (Math.random() * 80 + 10) + '%',
      animationDelay: delay + 's',
      animationDuration: (8 + Math.random() * 5) + 's',
      zIndex: 0,
      opacity: 0.3
    }}
  />
);

const ParticleField = () => (
  <div className="absolute inset-0 pointer-events-none opacity-20">
    {[...Array(30)].map((_, i) => (
      <div 
        key={i}
        className="absolute bg-white rounded-full animate-float"
        style={{
          width: '1.5px',
          height: '1.5px',
          left: Math.random() * 100 + '%',
          top: Math.random() * 100 + '%',
          animationDelay: (Math.random() * 5) + 's',
          animationDuration: (15 + Math.random() * 10) + 's',
        }}
      />
    ))}
  </div>
);

// --- Phase Specific Tools ---

const RigorRace = () => {
  const [loading, setLoading] = useState(false);
  const [output, setOutput] = useState("");
  
  const simulateLLM = () => {
    setLoading(true);
    setTimeout(() => {
      setOutput("In the multifaceted landscape of contemporary pedagogical paradigms, the implementation of rigorous evaluative frameworks is paramount to ensuring optimal student outcomes and information processing synthesis...");
      setLoading(false);
    }, 1500);
  };

  return (
    <div className="space-y-4 bg-white/[0.03] p-6 border border-white/10 rounded">
      <div className="flex justify-between items-center">
        <span className="text-[10px] tracking-widest uppercase text-neutral-500">LLM Output Simulator</span>
        <button onClick={simulateLLM} className="flex items-center gap-2 text-[10px] border border-white/20 px-3 py-1 hover:bg-white hover:text-black transition-all uppercase">
          <RefreshCw className={`w-3 h-3 ${loading ? 'animate-spin' : ''}`} /> Run Rigor Race
        </button>
      </div>
      <div className="min-h-[80px] font-serif italic text-neutral-400 text-lg leading-snug">
        {loading ? "Strutting and bellowing..." : output || "Click to generate 'Nature's Journeyman' text."}
      </div>
      {output && (
        <div className="text-[10px] text-rose-400 uppercase tracking-tighter pt-2 border-t border-white/5">
          Verdict: Overdone. Lacks the gait of man. Imitates humanity abominably.
        </div>
      )}
    </div>
  );
};

const App = () => {
  const [activeNode, setActiveNode] = useState(null);
  const [hoveredNode, setHoveredNode] = useState(null);
  const [userPledge, setUserPledge] = useState("");
  const [manifesto, setManifesto] = useState([
    "I will protect the silence between thoughts.",
    "Rigor is the weight of attention, not the count of words.",
    "Suit the action to the word."
  ]);

  const workshopNodes = [
    { 
      id: 'mirror', 
      label: 'Phase 1: The Mirror', 
      icon: <Eye />, 
      x: '25%', y: '25%', 
      title: "Unmasking the Illusion",
      content: "Compare the machine's 'strut and bellow' to the human 'form and pressure.' Does high volume equal high rigor?",
      type: 'rigor-race',
      color: "border-indigo-500/50 text-indigo-400"
    },
    { 
      id: 'audit', 
      label: 'Phase 2: The Human Pivot', 
      icon: <Brain />, 
      x: '50%', y: '45%', 
      title: "The Attention Audit",
      content: "Explore the divide between Informational Processing (The Algorithmic) and the Vital Stirring (The Judicious).",
      type: 'audit',
      color: "border-rose-500 text-rose-400" 
    },
    { 
      id: 'lab', 
      label: 'Phase 3: The Lab', 
      icon: <Layers />, 
      x: '20%', y: '70%', 
      title: "Embodied Design",
      content: "Redesign learning through Vital Levers: Radical Presence, Modesty of Nature, and The Lab of the Living.",
      type: 'levers',
      color: "border-emerald-500/50 text-emerald-400"
    },
    { 
      id: 'vital', 
      label: 'Phase 4: Reclaiming', 
      icon: <Sparkles />, 
      x: '80%', y: '70%', 
      title: "Reclaiming the Vital",
      content: "How do we ensure our students don't become merely players imitating humanity for a grade?",
      type: 'pledge',
      color: "border-sky-500/50 text-sky-400"
    },
    { 
      id: 'materials', 
      label: 'Tactile Materials', 
      icon: <Hourglass />, 
      x: '75%', y: '20%', 
      title: "The Physics of Presence",
      content: "Hourglasses, tactile journals, and the mirror. Tools to ground the attention in time and space.",
      color: "border-amber-500/50 text-amber-400"
    }
  ];

  const handleAddPledge = () => {
    if (userPledge.trim()) {
      setManifesto([userPledge, ...manifesto]);
      setUserPledge("");
    }
  };

  const activeNodeData = workshopNodes.find(n => n.id === activeNode);

  return (
    <div className="relative min-h-screen bg-[#020202] text-neutral-200 overflow-hidden font-mono selection:bg-white selection:text-black">
      
      {/* Background Visuals */}
      <div className="absolute inset-0 z-0">
        <FloatingMatter delay={0} color="bg-indigo-900/30" size={600} />
        <FloatingMatter delay={4} color="bg-rose-900/20" size={400} />
        <FloatingMatter delay={2} color="bg-emerald-900/20" size={500} />
        <ParticleField />
        <div className="absolute inset-0 bg-gradient-to-b from-transparent via-white/[0.01] to-transparent h-20 w-full animate-scanline pointer-events-none" />
      </div>

      {/* Header */}
      <div className="fixed top-8 left-8 z-50 pointer-events-none">
        <div className="flex items-center gap-3 mb-2">
          <BookOpen className="w-4 h-4 text-neutral-500" />
          <h1 className="text-[10px] tracking-[0.6em] uppercase text-neutral-500">Workshop Guide: 90m</h1>
        </div>
        <div className="text-3xl font-light tracking-tighter text-white">
          Beyond the <span className="italic opacity-50 font-serif">Illusion of Rigor</span>
        </div>
        <div className="text-[10px] text-neutral-600 mt-2 tracking-widest">
          AUTHENTICITY // INTENTIONALITY // EXPERIENTIAL PEDAGOGY
        </div>
      </div>

      {/* Field Controller Overlay */}
      <div className="fixed bottom-8 right-8 z-50 text-right">
        <div className="text-[9px] uppercase tracking-[0.5em] text-neutral-600 mb-2 flex items-center justify-end gap-2">
          <Activity className="w-3 h-3 animate-pulse" /> Experimental Status: Active
        </div>
        <div className="text-xs text-neutral-400 italic font-serif">
          {activeNode ? `Navigating: ${activeNodeData?.title}` : "Select a Phase to Inhabit..."}
        </div>
      </div>

      {/* Interactive Field */}
      <div className="relative w-full h-screen z-10">
        <svg className="absolute inset-0 w-full h-full opacity-10 pointer-events-none">
          <line x1="25%" y1="25%" x2="50%" y2="45%" stroke="white" strokeWidth="0.5" />
          <line x1="75%" y1="20%" x2="50%" y2="45%" stroke="white" strokeWidth="0.5" />
          <line x1="20%" y1="70%" x2="50%" y2="45%" stroke="white" strokeWidth="0.5" />
          <line x1="80%" y1="70%" x2="50%" y2="45%" stroke="white" strokeWidth="0.5" />
        </svg>

        {workshopNodes.map((node) => (
          <div
            key={node.id}
            className="absolute transition-all duration-500 ease-out cursor-pointer z-30 group"
            style={{ left: node.x, top: node.y }}
            onMouseEnter={() => setHoveredNode(node.id)}
            onMouseLeave={() => setHoveredNode(null)}
            onClick={() => setActiveNode(activeNode === node.id ? null : node.id)}
          >
            <div className={`
              w-14 h-14 rounded-full border flex items-center justify-center
              transition-all duration-300 relative backdrop-blur-md
              ${activeNode === node.id 
                ? 'bg-white scale-125 border-white text-black rotate-45 shadow-[0_0_30px_rgba(255,255,255,0.2)]' 
                : `bg-black/80 ${node.color} group-hover:scale-110 group-hover:border-white group-hover:bg-white/10`
              }
            `}>
              {node.id === 'audit' && activeNode !== 'audit' && (
                <div className="absolute inset-0 rounded-full animate-vital-pulse pointer-events-none border border-rose-500/50" />
              )}
              
              <div className={activeNode === node.id ? '-rotate-45' : ''}>
                {React.cloneElement(node.icon, { className: "w-5 h-5" })}
              </div>
              
              <div className={`
                absolute -top-10 left-1/2 -translate-x-1/2 whitespace-nowrap text-[9px] uppercase tracking-[0.3em]
                transition-all duration-200 pointer-events-none z-50
                ${(hoveredNode === node.id || activeNode === node.id) ? 'opacity-100 translate-y-0 text-white' : 'opacity-0 translate-y-2'}
              `}>
                {node.label}
              </div>
            </div>
          </div>
        ))}

        {/* Dynamic Modal / Workspace */}
        <div className={`
          fixed inset-0 flex items-center justify-center z-40 pointer-events-none transition-all duration-500
          ${activeNode ? 'bg-black/60 opacity-100 backdrop-blur-sm' : 'opacity-0'}
        `}>
          <div className={`
            max-w-2xl w-full mx-4 p-8 bg-[#0a0a0a] border border-white/10 rounded-sm pointer-events-auto
            transition-all duration-500 shadow-[0_0_80px_rgba(0,0,0,0.8)]
            ${activeNode ? 'translate-y-0 scale-100' : 'translate-y-8 scale-95'}
          `}>
            {activeNode && (
              <div className="relative">
                <button 
                  onClick={() => setActiveNode(null)}
                  className="absolute -top-2 -right-2 p-2 text-neutral-500 hover:text-white transition-colors"
                >
                  <X className="w-5 h-5" />
                </button>

                <div className="flex items-center gap-3 mb-6">
                  <span className={`p-2 rounded-full bg-white/5 border border-white/10 ${activeNodeData.color}`}>
                    {activeNodeData.icon}
                  </span>
                  <div>
                    <h3 className="text-white font-light text-2xl tracking-tight">{activeNodeData.title}</h3>
                    <p className="text-[10px] text-neutral-500 uppercase tracking-widest">{activeNodeData.label}</p>
                  </div>
                </div>

                <div className="space-y-6 text-neutral-300">
                  <p className="text-lg leading-relaxed font-serif italic text-neutral-400">
                    "{activeNodeData.content}"
                  </p>

                  {activeNodeData.type === 'rigor-race' && <RigorRace />}

                  {activeNodeData.type === 'audit' && (
                    <div className="grid grid-cols-2 gap-4 pt-4">
                      <div className="p-5 border border-white/5 bg-white/[0.02] rounded-sm group hover:border-rose-500/30 transition-all">
                        <div className="flex items-center gap-2 mb-3">
                          <Cpu className="w-4 h-4 text-rose-400" />
                          <h4 className="text-[10px] uppercase font-bold tracking-tighter text-rose-400">The Algorithmic</h4>
                        </div>
                        <p className="text-[11px] text-neutral-500">Processing, optimizing, and imitating. Sorting without discretion.</p>
                      </div>
                      <div className="p-5 border border-white/5 bg-white/[0.02] rounded-sm group hover:border-emerald-500/30 transition-all">
                        <div className="flex items-center gap-2 mb-3">
                          <UserCheck className="w-4 h-4 text-emerald-400" />
                          <h4 className="text-[10px] uppercase font-bold tracking-tighter text-emerald-400">The Vital</h4>
                        </div>
                        <p className="text-[11px] text-neutral-500">Attending, noticing, and inhabiting. The stir of the soul.</p>
                      </div>
                    </div>
                  )}

                  {activeNodeData.type === 'levers' && (
                    <div className="space-y-2 pt-4">
                      {["Radical Presence (Live Dialogue, Real Friction)", "The Modesty of Nature (Human Scale)", "Lab of the Living (Lived Evidence)"].map((lever, i) => (
                        <div key={i} className="flex items-center gap-3 p-3 border border-white/5 text-xs text-neutral-400 hover:bg-white/5 transition-colors">
                          <Zap className="w-3 h-3 text-amber-500" /> {lever}
                        </div>
                      ))}
                    </div>
                  )}

                  {activeNodeData.type === 'pledge' && (
                    <div className="space-y-4 pt-4">
                      <div className="flex gap-2 border-b border-white/10 pb-2">
                        <input 
                          type="text" 
                          value={userPledge}
                          onChange={(e) => setUserPledge(e.target.value)}
                          placeholder="Your Humanity Pledge..."
                          className="bg-transparent flex-1 py-1 focus:outline-none text-sm italic"
                          onKeyDown={(e) => e.key === 'Enter' && handleAddPledge()}
                        />
                        <button onClick={handleAddPledge} className="text-white hover:translate-x-1 transition-transform">
                          <ArrowUpRight className="w-5 h-5" />
                        </button>
                      </div>
                      <div className="h-24 overflow-y-auto pr-2 custom-scrollbar">
                        {manifesto.map((m, i) => (
                          <div key={i} className="text-[11px] text-neutral-500 py-1 border-l border-white/10 pl-3 mb-2">{m}</div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      </div>

      <style dangerouslySetInnerHTML={{ __html: `
        .custom-scrollbar::-webkit-scrollbar { width: 2px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; }
        
        @keyframes float {
          0%, 100% { transform: translate(0, 0); }
          50% { transform: translate(20px, -20px); }
        }
        
        @keyframes scanline {
          from { transform: translateY(-100%); }
          to { transform: translateY(100vh); }
        }

        @keyframes vital-pulse {
          0% { transform: scale(1); opacity: 0.8; }
          100% { transform: scale(1.6); opacity: 0; }
        }

        .animate-float { animation: float linear infinite; }
        .animate-scanline { animation: scanline 12s linear infinite; }
        .animate-vital-pulse { animation: vital-pulse 2.5s infinite cubic-bezier(0, 0, 0.2, 1); }
      `}} />
    </div>
  );
};

export default App;